í•´ë‹¹ TILì€ swift programming languageë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ì„±í•˜ì˜€ìŠµë‹ˆë‹¤.   

<br>

## ìº¡ì²˜ë¦¬ìŠ¤íŠ¸(Capture List)
ìº¡ì²˜ë¦¬ìŠ¤íŠ¸ë¥¼ ì•Œì•„ë³´ê¸°ì— ì•ì„œ í´ë¡œì €ì˜ ìº¡ì²˜ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ì

### í´ë¡œì €ì˜ ìº¡ì²˜ë€?    
**í´ë¡œì € ë‚´ë¶€ì—ì„œ ì™¸ë¶€ì— ìˆëŠ” ê°’ì— ì ‘ê·¼í•˜ë©´ ê°’ì— ëŒ€í•œ ì°¸ì¡°ë¥¼ íšë“**ë¥¼ í•˜ëŠ”ë° ì´ê²ƒì„ `ìº¡ì²˜`ë¼ê³  ë¶€ë¥¸ë‹¤.   
ìº¡ì²˜ë¥¼ í•˜ê²Œ ë˜ë©´ ìƒìˆ˜ì™€ ë³€ìˆ˜ë¥¼ ì •ì˜í•œ ì›ë˜ì˜ ë²”ìœ„ê°€ ë” ì´ìƒ ì¡´ì¬í•˜ì§€ ì•Šë”ë¼ë„ í´ë¡œì € ë³¸ë¬¸ ë‚´ì—ì„œ í•´ë‹¹ ìƒìˆ˜ì™€ ë³€ìˆ˜ì˜ ê°’ì„ ì°¸ì¡°í•˜ê³  ìˆ˜ì •ê°€ëŠ¥í•˜ê²Œ ëœë‹¤.
``` swift
func makeIncrementer(forIncrement amount: Int) -> () -> Int {    
	var runningTotal = 0    
	func incrementer() -> Int {        
		runningTotal += amount        
		return runningTotal    
		}    
	return incrementer
}
```
ìœ„ì˜ ì˜ˆì œëŠ” ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìˆëŠ” ì˜ˆì œì´ë‹¤.    
`incrementer()`ì€ `runningTotal`ê³¼ `amount`ë¥¼ ìº¡ì²˜í•˜ê³  ìˆëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
```swift
let incrementByTen = makeIncrementer(forIncrement: 10)

incrementByTen()
// returns a value of 10
incrementByTen()
// returns a value of 20
incrementByTen()
// returns a value of 30
```

<br>

í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ì— í´ë¡œì €ë¥¼ í• ë‹¹í•˜ê³  í´ë¡œì €ê°€ ì¸ìŠ¤í„´ìŠ¤ ë˜ëŠ” í•´ë‹¹ ë©¤ë²„ë¥¼ ì°¸ì¡°í•˜ì—¬ í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìº¡ì²˜í•˜ëŠ” ê²½ìš° í´ë¡œì €ì™€ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ì´ì— ê°•í•œ ì°¸ì¡° ìˆœí™˜ì´ ë§Œë“¤ì–´ì§„ë‹¤. 
ê°•í•œ ì°¸ì¡° ì‚¬ì´í´ì´ í˜•ì„±ë˜ë©´ ì¸ìŠ¤í„´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ í•´ì œë˜ì§€ ì•ŠëŠ” ì¼ì´ ë°œìƒí•  ìˆ˜ ìˆë‹¤.   
SwiftëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸°ìœ„í•œ ìš°ì•„í•œ ë°©ë²•ì„ ì œì‹œí•˜ì˜€ëŠ”ë°, ê·¸ê²ƒì´ ë°”ë¡œ `ìº¡ì²˜ë¦¬ìŠ¤íŠ¸`ì´ë‹¤.

<br>

### í´ë¡œì €ì˜ ê°•í•œ ì°¸ì¡° ìˆœí™˜
ê°•í•œ ì°¸ì¡° ìˆœí™˜ì€ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì˜ ì†ì„±ì— í´ë¡œì €ë¥¼ í• ë‹¹í•˜ê³  í•´ë‹¹ í´ë¡œì €ì˜ ë³¸ë¬¸ì´ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìº¡ì²˜í•˜ëŠ” ê²½ìš°ì—ë„ ë°œìƒí•  ìˆ˜ ìˆë‹¤.   

<br>

ì´ ê²½ìš° ì™œ ê°•í•œ ì°¸ì¡° ìˆœí™˜ì´ ë°œìƒí• ê¹Œ?ğŸ¤”   
`í´ë¡œì €ê°€Â í´ë˜ìŠ¤ì™€ ê°™ì€ ì°¸ì¡° í˜•ì‹ì´ê¸° ë•Œë¬¸`ì— ë°œìƒí•œë‹¤!   
1. í”„ë¡œí¼í‹°ì— í´ë¡œì €ë¥¼ í• ë‹¹í•˜ë©´
2. í”„ë¡œí¼í‹°ì— í•´ë‹¹ í´ë¡œì €ì— ëŒ€í•œ ì°¸ì¡°ê°€ í• ë‹¹ëœë‹¤.
3. ë³¸ì§ˆì ìœ¼ë¡œ ë‘ ê°œì˜ ê°•í•œ ì°¸ì¡°ê°€ ì„œë¡œë¥¼ ì‚´ë¦¬ê³  ìˆëŠ” ê²ƒ -> ì„œë¡œë¥¼ ìœ ì§€ì‹œí‚¤ëŠ” í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ì™€ í´ë¡œì €ì¸ ìƒ˜!    

ê³µì‹ë¬¸ì„œ ì˜ˆì œë¡œ ì‚´í´ë³´ë„ë¡ í•˜ì
```swift
class HTMLElement {
    let name: String
    let text: String?

    lazy var asHTML: () -> String = {
        if let text = self.text {
            return "<\(self.name)>\(text)</\(self.name)>"
        } else {
            return "<\(self.name) />"
        }
    }

    init(name: String, text: String? = nil) {
        self.name = name
        self.text = text
    }

    deinit {
        print("\(name) is being deinitialized")
    }
}
```
`asHTMLì€Â nameÂ ê³¼ textÂ ì„ HTML ë¬¸ìì—´ë¡œ ê²°í•©í•˜ëŠ” í´ë¡œì €ë¥¼ ì°¸ì¡°`í•˜ê³  ìˆë‹¤.   
```swift
var paragraph: HTMLElement? = HTMLElement(name: "p", text: "hello, world")
print(paragraph!.asHTML())
// Prints "<p>hello, world</p>"
```

![](https://docs.swift.org/swift-book/images/closureReferenceCycle01@2x.png)   
1. ì¸ìŠ¤í„´ìŠ¤ì˜Â asHTMLÂ ì†ì„±ì€ í´ë¡œì €ì— ëŒ€í•œ ê°•í•œ ì°¸ì¡°ë¥¼ ë³´ìœ í•˜ê³ 
2. í´ë¡œì €ëŠ” ë³¸ë¬¸ ë‚´ì—ì„œ selfë¥¼ ì°¸ì¡°í•˜ê³  ìˆë‹¤.
3. í´ë¡œì €ëŠ”Â self.name, self.textë¥¼ ìº¡ì²˜í•˜ëŠ”ë° -> HTMLElementÂ ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ê°•ë ¥í•œ ì°¸ì¡°ë¥¼Â ë‹¤ì‹œ ë³´ìœ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.
4. ì¦‰, ë‘˜ ì‚¬ì´ì— ê°•í•œ ì°¸ì¡° ì£¼ê¸°ê°€ ìƒì„±ëœë‹¤.
5. paragraphÂ ë³€ìˆ˜ë¥¼Â nilë¡œ ì„¤ì •í•˜ê³  HTMLElement ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•œ ê°•í•œ ì°¸ì¡°ë¥¼ ëŠìœ¼ë©´ ê°•ë ¥í•œ ì°¸ì¡° ì£¼ê¸°ë¡œ ì¸í•´Â HTMLElementÂ ì¸ìŠ¤í„´ìŠ¤ì™€ í´ë¡œì €ì˜ í• ë‹¹ì´ ëª¨ë‘Â ì·¨ì†Œë˜ì§€ ì•Šê²Œ ëœë‹¤.

```swift
paragraph = nil
// deinitì´ í˜¸ì¶œë˜ì§€ ì•ŠìŒ...
```

<br>

í´ë¡œì €ì™€ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ì´ì˜ ê°•ë ¥í•œ ì°¸ì¡° ì£¼ê¸°ëŠ” í´ë¡œì € ì •ì˜ì˜ ì¼ë¶€ë¡œÂ ìº¡ì²˜ ë¦¬ìŠ¤íŠ¸ë¥¼Â ì •ì˜í•˜ì—¬ í•´ê²° ê°€ëŠ¥í•˜ë‹¤. 

<br>

### ìº¡ì²˜ë¦¬ìŠ¤íŠ¸
`ìº¡ì²˜ ë¦¬ìŠ¤íŠ¸`ëŠ” **í´ë¡œì € ë³¸ë¬¸ ë‚´ì—ì„œ í•˜ë‚˜ ì´ìƒì˜ ì°¸ì¡° í˜•ì‹ì„ ìº¡ì²˜í•  ë•Œ ì‚¬ìš©í•  ê·œì¹™ì„ ì •ì˜í•˜ëŠ” ê²ƒ**ìœ¼ë¡œ   
ìº¡ì²˜ëœ ê° ì°¸ì¡°ë¥¼ ê°•í•œ ì°¸ì¡°ê°€ ì•„ë‹Œ `ì•½í•œ ì°¸ì¡°(weak)ë‚˜ ë¯¸ì†Œìœ  ì°¸ì¡°(unowned)`ë¡œ ì„ ì–¸í•œë‹¤.    
ì‰½ê²Œ ë§í•˜ë©´, ìº¡ì²˜ë¦¬ìŠ¤íŠ¸ëŠ” `í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤(ì˜ˆ: self) ë˜ëŠ” ì¼ë¶€ ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ëœ ë³€ìˆ˜(ì˜ˆ:Â delegate = self.delegate)ì— ëŒ€í•œ ì°¸ì¡° +Â weakÂ ë˜ëŠ” unowned`ì˜ ìŒì´ë‹¤. (ì „í˜€ ì‰½ì§€ ì•Šì€ê²Œ í•¨ì •...)
```swift
lazy var someClosure = {
        [unowned self, weak delegate = self.delegate]
        (index: Int, stringToProcess: String) -> String in
    // closure body goes here
}
```
`[unowned self, weak delegate = self.delegate]` ì‰¼í‘œë¡œ êµ¬ë¶„ëœ í•œ ìŒì˜ ëŒ€ê´„í˜¸ ì•ˆì— ê¸°ë¡í•˜ë©°,   
í´ë¡œì €ì˜ ë§¤ê°œ ë³€ìˆ˜ ë¦¬ìŠ¤íŠ¸ ì•ì— ìº¡ì²˜ ë¦¬ìŠ¤íŠ¸ì™€ ì œê³µëœ ë¦¬í„´ íƒ€ì…ì„ ë°°ì¹˜í•œë‹¤.   

<br>

ë§Œì•½ í´ë¡œì €ê°€ ë§¤ê°œë³€ìˆ˜ ëª©ë¡ ë˜ëŠ” ë°˜í™˜ í˜•ì‹ì„ ì§€ì •í•˜ì§€ ì•Šì€ ê²½ìš°   
í´ë¡œì €ì˜ ë§¨ ì²˜ìŒì— ìº¡ì²˜ë¦¬ìŠ¤íŠ¸ë¥¼ ë°°ì¹˜í•˜ê³  in í‚¤ì›Œë“œë¥¼ ë°°ì¹˜í•œë‹¤.
``` swift
lazy var someClosure = {
        [unowned self, weak delegate = self.delegate] in
    // closure body goes here
}
```
<br>

### weak vs unowned
**unowned**   
- í´ë¡œì €ì˜ ìº¡ì²˜ë¥¼ ë¯¸ì†Œìœ  ì°¸ì¡°ë¡œ ì •ì˜í•˜ë©´ `í´ë¡œì €ì™€ í´ë¡œì €ê°€ ìº¡ì²˜í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ê°€ í•­ìƒ ì„œë¡œë¥¼ ì°¸ì¡°í•˜ê³  í•­ìƒ ë™ì‹œì— í• ë‹¹ì´ ì·¨ì†Œ`ëœë‹¤.
- ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ìˆ˜ëª…ì´ ê°™ê±°ë‚˜ ìˆ˜ëª…ì´ ë” ê¸´ ê²½ìš° ì†Œìœ ë˜ì§€ ì•Šì€ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•œë‹¤.
- ê°’ì„ unownedë¡œ í‘œì‹œí•´ë„ ì˜µì…”ë„ì´ ë˜ì§€ ì•Šìœ¼ë©° ARCëŠ” unowned ì°¸ì¡°ì˜ ê°’ì„Â nilë¡œ ì„¤ì •í•˜ì§€ ì•ŠëŠ”ë‹¤.
- í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ì˜ í• ë‹¹ì´ í•´ì œëœ í›„ ë¯¸ì†Œìœ  ì°¸ì¡°ì˜ ê°’ì— ì•¡ì„¸ìŠ¤í•˜ë ¤ê³  í•˜ë©´ ëŸ°íƒ€ì„ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤. -> ì°¸ì¡°ê°€ `í•­ìƒÂ í• ë‹¹ì´ í•´ì œë˜ì§€ ì•Šì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì°¸ì¡°í•œë‹¤ê³  í™•ì‹ í•˜ëŠ” ê²½ìš°ì—ë§Œ ì‚¬ìš©`í•œë‹¤.
- `ìº¡ì²˜ëœ ì°¸ì¡°ê°€Â nilì´ ë˜ì§€ ì•ŠëŠ” ê²½ìš° í•­ìƒ ì•½í•œ ì°¸ì¡°ê°€ ì•„ë‹Œ ì†Œìœ ë˜ì§€ ì•Šì€ ì°¸ì¡°ë¡œ ìº¡ì²˜í•´ì•¼ í•œë‹¤ê³  ê³µì‹ë¬¸ì„œì— ë‚˜ì™€ìˆë‹¤.`

**weak**   
- `ìº¡ì²˜ëœ ì°¸ì¡°ê°€ ë¯¸ë˜ì˜ ì–´ëŠ ì‹œì ì—ì„œÂ nilì´ ë  ìˆ˜ ìˆëŠ” ê²½ìš°` ìº¡ì²˜ë¥¼ ì•½í•œ ì°¸ì¡°ë¡œ ì •ì˜í•œë‹¤.
- ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ì˜ ìˆ˜ëª…ì´ ë” ì§§ì€ ê²½ìš°, ì¦‰ ë‹¤ë¥¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë¨¼ì € í• ë‹¹ í•´ì œë  ìˆ˜ ìˆëŠ” ê²½ìš° ì•½í•œ ì°¸ì¡°ë¥¼ ì‚¬ìš©í•œë‹¤.   
- `ì•½í•œ ì°¸ì¡°ëŠ” í•­ìƒ ì˜µì…”ë„ í˜•ì‹ì´ë©°, ì°¸ì¡°í•˜ëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ í• ë‹¹ì´ ì·¨ì†Œë˜ë©´ ìë™ìœ¼ë¡œÂ nil`ì´ ëœë‹¤. -> ì´ë¥¼ í†µí•´ í´ë¡œì € ë³¸ë¬¸ ë‚´ì—ì„œ ì¡´ì¬ë¥¼ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.

```swift
class HTMLElement {
    let name: String
    let text: String?

    lazy var asHTML: () -> String = {
            [unowned self] in
        if let text = self.text {
            return "<\(self.name)>\(text)</\(self.name)>"
        } else {
            return "<\(self.name) />"
        }
    }

    init(name: String, text: String? = nil) {
        self.name = name
        self.text = text
    }

    deinit {
        print("\(name) is being deinitialized")
    }
}

var paragraph: HTMLElement? = HTMLElement(name: "p", text: "hello, world")
print(paragraph!.asHTML())
// Prints "<p>hello, world</p>"
```
ìœ„ì˜ ì˜ˆì œì— ìº¡ì²˜ë¦¬ìŠ¤íŠ¸ë¥¼ ì ìš©í•œ ì˜ˆì œì´ë‹¤.   
ìº¡ì²˜ ë¦¬ìŠ¤íŠ¸ëŠ”Â `[unowned self]ì´ë©°, ì´ëŠ” "ê°•ë ¥í•œ ì°¸ì¡°ê°€ ì•„ë‹Œ ì†Œìœ ë˜ì§€ ì•Šì€ ì°¸ì¡°ë¡œ ìì‹ ì„ ìº¡ì²˜"`ë¥¼ ì˜ë¯¸í•œë‹¤.   

![](https://docs.swift.org/swift-book/images/closureReferenceCycle02@2x.png)
- í´ë¡œì €ì— ì˜í•œÂ selfÂ ìº¡ì²˜ëŠ” ë¯¸ì†Œìœ  ì°¸ì¡°ì´ë©° -> ìº¡ì²˜í•œÂ HTMLElementÂ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê°•ë ¥í•˜ê²Œ ìœ ì§€í•˜ì§€ ì•ŠëŠ”ë‹¤.

paragraphÂ ë³€ìˆ˜ì˜ ê°•ë ¥í•œ ì°¸ì¡°ë¥¼Â nilë¡œ ì„¤ì •í•˜ë©´ ì•„ë˜ ì˜ˆì œì˜ ì´ˆê¸°í™” í•´ì œ ë©”ì‹œì§€ ì¸ì‡„ì—ì„œ ë³¼ ìˆ˜ ìˆë“¯ì´Â HTMLElementÂ ì¸ìŠ¤í„´ìŠ¤ì˜ í• ë‹¹ì´ í•´ì œëœë‹¤.
```swift
paragraph = nil
// Prints "p is being deinitialized"
```

---
#### ì°¸ê³  ë¬¸ì„œ
[ì• í”Œ ê³µì‹ ë¬¸ì„œ - closure](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/closures/#Capturing-Values)   
[ì• í”Œ ê³µì‹ ë¬¸ì„œ - ARC](https://docs.swift.org/swift-book/documentation/the-swift-programming-language/automaticreferencecounting/#Strong-Reference-Cycles-for-Closures)   
